<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta property="og:title" content="Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library">
<meta property="og:description" content="A lightweight C++ Discord API library supporting the entire Discord API, including Slash Commands, Voice/Audio, Sharding, Clustering and more!">
<meta name="description" content="Join or switch to the voice channel of the user issuing a command - D++ - A lightweight C++ Discord API library supporting the entire Discord API, including Slash Commands, Voice/Audio, Sharding, Clustering and more!">
<meta property="og:image" content="https://dpp.dev/DPP-Logo.png">
<meta property="og:url" content="https://dpp.dev/">
<meta property="og:type" content="website">
<meta property="twitter:title" content="Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library">
<title>Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<script>
	setTimeout(function() {
		$("#main-menu").html($("#main-menu").html() + "<li><select name='vsv' onchange='window.location.href=this.options[this.selectedIndex].value'><option value='/'>master</option><option value='/9.0.13/'>9.0.13</option><option value='/9.0.12/'>9.0.12</option><option selected value='/9.0.11/'>9.0.11</option><option value='/9.0.10/'>9.0.10</option><option value='/9.0.9/'>9.0.9</option><option value='/9.0.8/'>9.0.8</option><option value='/9.0.7/'>9.0.7</option><option value='/9.0.6/'>9.0.6</option><option value='/9.0.5/'>9.0.5</option><option value='/9.0.4/'>9.0.4</option><option value='/9.0.3/'>9.0.3</option><option value='/9.0.2/'>9.0.2</option><option value='/9.0.1/'>9.0.1</option><option value='/9.0.0/'>9.0.0</option><option value='/1.0.2/'>1.0.2</option><option value='/1.0.1/'>1.0.1</option><option value='/1.0.0/'>1.0.0</option></select></li>");
	}, 500);
</script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="DPP-Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">D++ (DPP)
   </div>
   <div id="projectbrief">A Lightweight C++ library for Discord</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<label for="MSearchField" style="display: none">Search</label>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('joinvc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Join or switch to the voice channel of the user issuing a command </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >When a user issues a command you may want to join their voice channel, e.g. in a music bot. If you are already on the same voice channel, the bot should do nothing (but be ready to instantly play audio) and if the user is on a different voice channel, the bot should switch to it. If the user is on no voice channel at all, this should be considered an error. This example shows how to do this.</p>
<dl class="section note"><dt>Note</dt><dd>Please be aware this example sends no audio, but indicates clearly in the comments where and how you should do so.</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;dpp/dpp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Setup the bot */</span></div>
<div class="line">    <a class="code hl_class" href="classdpp_1_1cluster.html">dpp::cluster</a> bot(<span class="stringliteral">&quot;token&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Use the on_message_create event to look for commands */</span></div>
<div class="line">    bot.on_message_create([&amp;bot, robot, robot_size](<span class="keyword">const</span> <a class="code hl_struct" href="structdpp_1_1message__create__t.html">dpp::message_create_t</a> &amp; event) {</div>
<div class="line"> </div>
<div class="line">        std::stringstream ss(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#acb17877db423d2ac4b103a67e1ae2ff6">content</a>);</div>
<div class="line">        std::string command;</div>
<div class="line"> </div>
<div class="line">        ss &gt;&gt; command;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Switch to or join the vc the user is on. Syntax: .join  */</span></div>
<div class="line">        <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;.join&quot;</span>) {</div>
<div class="line">            <a class="code hl_class" href="classdpp_1_1guild.html">dpp::guild</a> * g = <a class="code hl_function" href="namespacedpp.html#a3a13097fcd3f19b409e2a15b9fa56f90">dpp::find_guild</a>(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">            <span class="keyword">auto</span> current_vc = <span class="keyword">event</span>.from-&gt;get_voice(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">            <span class="keywordtype">bool</span> join_vc = <span class="keyword">true</span>;</div>
<div class="line">            <span class="comment">/* Check if we are currently on any vc */</span></div>
<div class="line">            <span class="keywordflow">if</span> (current_vc) {</div>
<div class="line">                <span class="comment">/* Find the channel id  that the user is currently on */</span></div>
<div class="line">                <span class="keyword">auto</span> users_vc = g-&gt;<a class="code hl_variable" href="classdpp_1_1guild.html#a42066fe3bbfb976ba27fbb9ca38b722f">voice_members</a>.find(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#a35c14f04382266b29c4ca076b4e0f9e0">author</a>-&gt;<a class="code hl_variable" href="classdpp_1_1managed.html#a40bf0c6cc03909910512808fa6caa112">id</a>);</div>
<div class="line">                <span class="comment">/* See if we currently share a channel with the user */</span></div>
<div class="line">                <span class="keywordflow">if</span> (users_vc != g-&gt;<a class="code hl_variable" href="classdpp_1_1guild.html#a42066fe3bbfb976ba27fbb9ca38b722f">voice_members</a>.end() &amp;&amp; current_vc-&gt;channel_id == users_vc-&gt;second.channel_id) {</div>
<div class="line">                    join_vc = <span class="keyword">false</span>;</div>
<div class="line">                    <span class="comment">/* We are on this voice channel, at this point we can send any audio instantly to vc:</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">                     * current_vc-&gt;send_audio_raw(...)</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">/* We are on a different voice channel. Leave it, then join the new one </span></div>
<div class="line"><span class="comment">                     * by falling through to the join_vc branch below.</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                    <span class="keyword">event</span>.from-&gt;disconnect_voice(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">                    join_vc = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* If we need to join a vc at all, join it here if join_vc == true */</span></div>
<div class="line">            <span class="keywordflow">if</span> (join_vc) {</div>
<div class="line">                <span class="keywordflow">if</span> (!g-&gt;<a class="code hl_function" href="classdpp_1_1guild.html#a0d5e43e678d6a0448930bd31620d979e">connect_member_voice</a>(event.<a class="code hl_variable" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code hl_variable" href="structdpp_1_1message.html#a35c14f04382266b29c4ca076b4e0f9e0">author</a>-&gt;<a class="code hl_variable" href="classdpp_1_1managed.html#a40bf0c6cc03909910512808fa6caa112">id</a>)) {</div>
<div class="line">                    <span class="comment">/* The user issuing the command is not on any voice channel, we can&#39;t do anything */</span></div>
<div class="line">                    bot.message_create(<a class="code hl_struct" href="structdpp_1_1message.html">dpp::message</a>(channel_id, <span class="stringliteral">&quot;You don&#39;t seem to be on a voice channel! :(&quot;</span>));</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">/* We are now connecting to a vc. Wait for on_voice_ready </span></div>
<div class="line"><span class="comment">                     * event, and then send the audio within that event:</span></div>
<div class="line"><span class="comment">                     * </span></div>
<div class="line"><span class="comment">                     * event.voice_client-&gt;send_audio_raw(...);</span></div>
<div class="line"><span class="comment">                     * </span></div>
<div class="line"><span class="comment">                     * NOTE: We can&#39;t instantly send audio, as we have to wait for</span></div>
<div class="line"><span class="comment">                     * the connection to the voice server to be established!</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Start bot */</span></div>
<div class="line">    bot.start(<span class="keyword">false</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassdpp_1_1cluster_html"><div class="ttname"><a href="classdpp_1_1cluster.html">dpp::cluster</a></div><div class="ttdoc">The cluster class represents a group of shards and a command queue for sending and receiving commands...</div><div class="ttdef"><b>Definition:</b> cluster.h:238</div></div>
<div class="ttc" id="aclassdpp_1_1guild_html"><div class="ttname"><a href="classdpp_1_1guild.html">dpp::guild</a></div><div class="ttdoc">Represents a guild on Discord (AKA a server)</div><div class="ttdef"><b>Definition:</b> guild.h:313</div></div>
<div class="ttc" id="aclassdpp_1_1guild_html_a0d5e43e678d6a0448930bd31620d979e"><div class="ttname"><a href="classdpp_1_1guild.html#a0d5e43e678d6a0448930bd31620d979e">dpp::guild::connect_member_voice</a></div><div class="ttdeci">bool connect_member_voice(snowflake user_id, bool self_mute=false, bool self_deaf=false)</div><div class="ttdoc">Connect to a voice channel another guild member is in.</div><div class="ttdef"><b>Definition:</b> guild.cpp:532</div></div>
<div class="ttc" id="aclassdpp_1_1guild_html_a42066fe3bbfb976ba27fbb9ca38b722f"><div class="ttname"><a href="classdpp_1_1guild.html#a42066fe3bbfb976ba27fbb9ca38b722f">dpp::guild::voice_members</a></div><div class="ttdeci">std::map&lt; snowflake, voicestate &gt; voice_members</div><div class="ttdef"><b>Definition:</b> guild.h:408</div></div>
<div class="ttc" id="aclassdpp_1_1managed_html_a40bf0c6cc03909910512808fa6caa112"><div class="ttname"><a href="classdpp_1_1managed.html#a40bf0c6cc03909910512808fa6caa112">dpp::managed::id</a></div><div class="ttdeci">snowflake id</div><div class="ttdef"><b>Definition:</b> discord.h:44</div></div>
<div class="ttc" id="anamespacedpp_html_a3a13097fcd3f19b409e2a15b9fa56f90"><div class="ttname"><a href="namespacedpp.html#a3a13097fcd3f19b409e2a15b9fa56f90">dpp::find_guild</a></div><div class="ttdeci">guild * find_guild(snowflake id)</div><div class="ttdef"><b>Definition:</b> cache.cpp:158</div></div>
<div class="ttc" id="astructdpp_1_1message__create__t_html"><div class="ttname"><a href="structdpp_1_1message__create__t.html">dpp::message_create_t</a></div><div class="ttdoc">Create message.</div><div class="ttdef"><b>Definition:</b> dispatcher.h:1109</div></div>
<div class="ttc" id="astructdpp_1_1message__create__t_html_a93c10b3fce36e161eca41edcd32857d0"><div class="ttname"><a href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">dpp::message_create_t::msg</a></div><div class="ttdeci">message * msg</div><div class="ttdoc">message that was created (sent). If you use any parts of this in another thread, take a copy!...</div><div class="ttdef"><b>Definition:</b> dispatcher.h:1119</div></div>
<div class="ttc" id="astructdpp_1_1message_html"><div class="ttname"><a href="structdpp_1_1message.html">dpp::message</a></div><div class="ttdoc">Represents messages sent and received on Discord.</div><div class="ttdef"><b>Definition:</b> message.h:959</div></div>
<div class="ttc" id="astructdpp_1_1message_html_a35c14f04382266b29c4ca076b4e0f9e0"><div class="ttname"><a href="structdpp_1_1message.html#a35c14f04382266b29c4ca076b4e0f9e0">dpp::message::author</a></div><div class="ttdeci">user * author</div><div class="ttdef"><b>Definition:</b> message.h:967</div></div>
<div class="ttc" id="astructdpp_1_1message_html_a5e75f7cd8a7e952e6621c520627d5b84"><div class="ttname"><a href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">dpp::message::guild_id</a></div><div class="ttdeci">snowflake guild_id</div><div class="ttdef"><b>Definition:</b> message.h:965</div></div>
<div class="ttc" id="astructdpp_1_1message_html_acb17877db423d2ac4b103a67e1ae2ff6"><div class="ttname"><a href="structdpp_1_1message.html#acb17877db423d2ac4b103a67e1ae2ff6">dpp::message::content</a></div><div class="ttdeci">std::string content</div><div class="ttdef"><b>Definition:</b> message.h:971</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docpages_03_example_programs.html">Example Programs</a></li>
  </ul>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTH6YHBNG5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
        gtag('config', 'G-QTH6YHBNG5');
</script>
<div style="z-index: -9999; position: absolute; right: 0; top: 0; font-size: 0.0001rem;color:transparent;background:none">
	<!-- For crawlability of past versions -->
	<a href='/9.0.13/'>D++ Library version 9.0.13</a><a href='/9.0.12/'>D++ Library version 9.0.12</a><a href='/9.0.11/'>D++ Library version 9.0.11</a><a href='/9.0.10/'>D++ Library version 9.0.10</a><a href='/9.0.9/'>D++ Library version 9.0.9</a><a href='/9.0.8/'>D++ Library version 9.0.8</a><a href='/9.0.7/'>D++ Library version 9.0.7</a><a href='/9.0.6/'>D++ Library version 9.0.6</a><a href='/9.0.5/'>D++ Library version 9.0.5</a><a href='/9.0.4/'>D++ Library version 9.0.4</a><a href='/9.0.3/'>D++ Library version 9.0.3</a><a href='/9.0.2/'>D++ Library version 9.0.2</a><a href='/9.0.1/'>D++ Library version 9.0.1</a><a href='/9.0.0/'>D++ Library version 9.0.0</a><a href='/1.0.2/'>D++ Library version 1.0.2</a><a href='/1.0.1/'>D++ Library version 1.0.1</a><a href='/1.0.0/'>D++ Library version 1.0.0</a>
</div>
</body>
</html>
