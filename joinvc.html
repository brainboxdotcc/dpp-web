<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta charset="utf-8">
<meta property="og:title" content="Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library">
<meta property="og:description" content="A lightweight C++ Discord API library supporting the entire Discord API, including Slash Commands, Voice/Audio, Sharding, Clustering and more!">
<meta property="og:image" content="https://dpp.brainbox.cc/DPP-Logo.png">
<meta property="og:url" content="https://dpp.brainbox.cc/">
<meta property="og:type" content="website">
<meta property="twitter:title" content="Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library">
<title>Join or switch to the voice channel of the user issuing a command - D++ - The lightweight C++ Discord API Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="DPP-Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">D++ (DPP)
   </div>
   <div id="projectbrief">A Lightweight C++ library for Discord</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('joinvc.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Join or switch to the voice channel of the user issuing a command </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>When a user issues a command you may want to join their voice channel, e.g. in a music bot. If you are already on the same voice channel, the bot should do nothing (but be ready to instantly play audio) and if the user is on a different voice channel, the bot should switch to it. If the user is on no voice channel at all, this should be considered an error. This example shows how to do this.</p>
<dl class="section note"><dt>Note</dt><dd>Please be aware this example sends no audio, but indicates clearly in the comments where and how you should do so.</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;dpp/dpp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Setup the bot */</span></div>
<div class="line">    <a class="code" href="classdpp_1_1cluster.html">dpp::cluster</a> bot(<span class="stringliteral">&quot;token&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Use the on_message_create event to look for commands */</span></div>
<div class="line">    bot.on_message_create([&amp;bot, robot, robot_size](<span class="keyword">const</span> <a class="code" href="structdpp_1_1message__create__t.html">dpp::message_create_t</a> &amp; event) {</div>
<div class="line"></div>
<div class="line">        std::stringstream ss(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#acb17877db423d2ac4b103a67e1ae2ff6">content</a>);</div>
<div class="line">        std::string command;</div>
<div class="line"></div>
<div class="line">        ss &gt;&gt; command;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Switch to or join the vc the user is on. Syntax: .join  */</span></div>
<div class="line">        <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;.join&quot;</span>) {</div>
<div class="line">            <a class="code" href="classdpp_1_1guild.html">dpp::guild</a> * g = <a class="code" href="namespacedpp.html#a6c9b2178f66c62051b390471ec776a80">dpp::find_guild</a>(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">            <span class="keyword">auto</span> current_vc = <span class="keyword">event</span>.from-&gt;get_voice(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">            <span class="keywordtype">bool</span> join_vc = <span class="keyword">true</span>;</div>
<div class="line">            <span class="comment">/* Check if we are currently on any vc */</span></div>
<div class="line">            <span class="keywordflow">if</span> (current_vc) {</div>
<div class="line">                <span class="comment">/* Find the channel id  that the user is currently on */</span></div>
<div class="line">                <span class="keyword">auto</span> users_vc = g-&gt;<a class="code" href="classdpp_1_1guild.html#a42066fe3bbfb976ba27fbb9ca38b722f">voice_members</a>.find(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#a35c14f04382266b29c4ca076b4e0f9e0">author</a>-&gt;<a class="code" href="classdpp_1_1managed.html#a40bf0c6cc03909910512808fa6caa112">id</a>);</div>
<div class="line">                <span class="comment">/* See if we currently share a channel with the user */</span></div>
<div class="line">                <span class="keywordflow">if</span> (users_vc != g-&gt;<a class="code" href="classdpp_1_1guild.html#a42066fe3bbfb976ba27fbb9ca38b722f">voice_members</a>.end() &amp;&amp; current_vc-&gt;channel_id == users_vc-&gt;second.channel_id) {</div>
<div class="line">                    join_vc = <span class="keyword">false</span>;</div>
<div class="line">                    <span class="comment">/* We are on this voice channel, at this point we can send any audio instantly to vc:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">                     * current_vc-&gt;send_audio_raw(...)</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">/* We are on a different voice channel. Leave it, then join the new one </span></div>
<div class="line"><span class="comment">                     * by falling through to the join_vc branch below.</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                    <span class="keyword">event</span>.from-&gt;disconnect_voice(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#a5e75f7cd8a7e952e6621c520627d5b84">guild_id</a>);</div>
<div class="line">                    join_vc = <span class="keyword">true</span>;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* If we need to join a vc at all, join it here if join_vc == true */</span></div>
<div class="line">            <span class="keywordflow">if</span> (join_vc) {</div>
<div class="line">                <span class="keywordflow">if</span> (!g-&gt;<a class="code" href="classdpp_1_1guild.html#a0d5e43e678d6a0448930bd31620d979e">connect_member_voice</a>(event.<a class="code" href="structdpp_1_1message__create__t.html#a93c10b3fce36e161eca41edcd32857d0">msg</a>-&gt;<a class="code" href="structdpp_1_1message.html#a35c14f04382266b29c4ca076b4e0f9e0">author</a>-&gt;<a class="code" href="classdpp_1_1managed.html#a40bf0c6cc03909910512808fa6caa112">id</a>)) {</div>
<div class="line">                    <span class="comment">/* The user issuing the command is not on any voice channel, we can&#39;t do anything */</span></div>
<div class="line">                    bot.message_create(<a class="code" href="structdpp_1_1message.html">dpp::message</a>(channel_id, <span class="stringliteral">&quot;You don&#39;t seem to be on a voice channel! :(&quot;</span>));</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="comment">/* We are now connecting to a vc. Wait for on_voice_ready </span></div>
<div class="line"><span class="comment">                     * event, and then send the audio within that event:</span></div>
<div class="line"><span class="comment">                     * </span></div>
<div class="line"><span class="comment">                     * event.voice_client-&gt;send_audio_raw(...);</span></div>
<div class="line"><span class="comment">                     * </span></div>
<div class="line"><span class="comment">                     * NOTE: We can&#39;t instantly send audio, as we have to wait for</span></div>
<div class="line"><span class="comment">                     * the connection to the voice server to be established!</span></div>
<div class="line"><span class="comment">                     */</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Start bot */</span></div>
<div class="line">    bot.start(<span class="keyword">false</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="md_docpages_03_example_programs.html">Example Programs</a></li>
  </ul>
</div>
</body>
</html>
