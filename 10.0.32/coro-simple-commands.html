<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="utf-8">
<meta property="og:title" content="Making simple commands - D++ - The lightweight C++ Discord API Library">
<meta property="og:description" content="A lightweight C++ Discord API library supporting the entire Discord API, including Slash Commands, Voice/Audio, Sharding, Clustering and more!">
<meta name="description" content="Making simple commands - D++ - A lightweight C++ Discord API library supporting the entire Discord API, including Slash Commands, Voice/Audio, Sharding, Clustering and more!">
<meta property="og:image" content="https://dpp.dev/DPP-Logo.png">
<meta property="og:url" content="https://dpp.dev/">
<meta property="og:type" content="website">
<meta property="twitter:title" content="Making simple commands - D++ - The lightweight C++ Discord API Library">
<title>Making simple commands - D++ - The lightweight C++ Discord API Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<script>
	setTimeout(function() {
		$("#main-menu").html($("#main-menu").html() + "<li><select name='vsv' onchange='window.location.href=this.options[this.selectedIndex].value'><option value='/'>master</option><option value='/10.0.35/'>10.0.35</option><option value='/10.0.34/'>10.0.34</option><option value='/10.0.33/'>10.0.33</option><option selected value='/10.0.32/'>10.0.32</option><option value='/10.0.31/'>10.0.31</option><option value='/10.0.30/'>10.0.30</option><option value='/10.0.29/'>10.0.29</option><option value='/10.0.28/'>10.0.28</option><option value='/10.0.27/'>10.0.27</option><option value='/10.0.26/'>10.0.26</option><option value='/10.0.25/'>10.0.25</option><option value='/10.0.24/'>10.0.24</option><option value='/10.0.23/'>10.0.23</option><option value='/10.0.22/'>10.0.22</option><option value='/10.0.21/'>10.0.21</option><option value='/10.0.20/'>10.0.20</option><option value='/10.0.19/'>10.0.19</option><option value='/10.0.18/'>10.0.18</option><option value='/10.0.17/'>10.0.17</option><option value='/10.0.16/'>10.0.16</option><option value='/10.0.15/'>10.0.15</option><option value='/10.0.14/'>10.0.14</option><option value='/10.0.13/'>10.0.13</option><option value='/10.0.12/'>10.0.12</option><option value='/10.0.11/'>10.0.11</option><option value='/10.0.10/'>10.0.10</option><option value='/10.0.9/'>10.0.9</option><option value='/10.0.8/'>10.0.8</option><option value='/10.0.7/'>10.0.7</option><option value='/10.0.6/'>10.0.6</option><option value='/10.0.5/'>10.0.5</option><option value='/10.0.4/'>10.0.4</option><option value='/10.0.3/'>10.0.3</option><option value='/10.0.2/'>10.0.2</option><option value='/10.0.1/'>10.0.1</option><option value='/10.0.0/'>10.0.0</option><option value='/9.0.19/'>9.0.19</option><option value='/9.0.18/'>9.0.18</option><option value='/9.0.17/'>9.0.17</option><option value='/9.0.16/'>9.0.16</option><option value='/9.0.15/'>9.0.15</option><option value='/9.0.14/'>9.0.14</option><option value='/9.0.13/'>9.0.13</option><option value='/9.0.12/'>9.0.12</option><option value='/9.0.11/'>9.0.11</option><option value='/9.0.10/'>9.0.10</option><option value='/9.0.9/'>9.0.9</option><option value='/9.0.8/'>9.0.8</option><option value='/9.0.7/'>9.0.7</option><option value='/9.0.6/'>9.0.6</option><option value='/9.0.5/'>9.0.5</option><option value='/9.0.4/'>9.0.4</option><option value='/9.0.3/'>9.0.3</option><option value='/9.0.2/'>9.0.2</option><option value='/9.0.1/'>9.0.1</option><option value='/9.0.0/'>9.0.0</option><option value='/1.0.2/'>1.0.2</option><option value='/1.0.1/'>1.0.1</option><option value='/1.0.0/'>1.0.0</option></select></li>");
	}, 500);
</script>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  <td id="projectlogo"><img alt="Logo" src="DPP-Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">D++ (DPP)
   </div>
   <div id="projectbrief">C++ Discord API Bot Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<label for="MSearchField" style="display: none">Search</label>
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('coro-simple-commands.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Making simple commands </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><dl class="section warning"><dt>Warning</dt><dd>D++ Coroutines are a very new feature and are currently only supported by D++ on g++ 13, clang/LLVM 14, and MSVC 19.37 or above. Additionally, D++ must be built with the CMake option DPP_CORO, and your program must both define the macro DPP_CORO and use C++20 or above. </dd></dl>
</p>
<h3><a class="anchor" id="autotoc_md136"></a>
Several steps in one</h3>
<dl class="section note"><dt>Note</dt><dd>The next example assumes you are already familiar with how to use <a class="el" href="firstbot.html">slash commands</a>, <a class="el" href="slashcommands.html">parameters</a>, and <a class="el" href="discord-application-command-file-upload.html">sending files through a command</a>.</dd></dl>
<p>With coroutines, it becomes a lot easier to do several asynchronous requests for one task. As an example an "addemoji" command taking a file and a name as a parameter. This means downloading the emoji, submitting it to Discord, and finally replying, with some error handling along the way. Normally we would have to use callbacks and some sort of object keeping track of our state, but with coroutines, the function can simply pause and be resumed when we receive the response to our request :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;dpp/dpp.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_class" href="classdpp_1_1cluster.html">dpp::cluster</a> bot{<span class="stringliteral">&quot;token&quot;</span>};</div>
<div class="line"> </div>
<div class="line">    bot.<a class="code hl_variable" href="classdpp_1_1cluster.html#ab840686c7cd2e15f4a66ab64f62e106b">on_log</a>(<a class="code hl_function" href="namespacedpp_1_1utility.html#a8c2cc04bb80ffd287b376d5977899277">dpp::utility::cout_logger</a>());</div>
<div class="line"> </div>
<div class="line">    bot.on_slashcommand([](<span class="keyword">const</span> <a class="code hl_struct" href="structdpp_1_1slashcommand__t.html">dpp::slashcommand_t</a>&amp; event) -&gt; <a class="code hl_class" href="classdpp_1_1task.html">dpp::task&lt;void&gt;</a> {</div>
<div class="line">        <span class="keywordflow">if</span> (event.<a class="code hl_variable" href="structdpp_1_1interaction__create__t.html#a8b0c69c156a1e532507a918c13414f14">command</a>.<a class="code hl_function" href="classdpp_1_1interaction.html#aabbb8d58d708128098516ed443d5c140">get_command_name</a>() == <span class="stringliteral">&quot;addemoji&quot;</span>) {</div>
<div class="line">            dpp::cluster *cluster = event.from-&gt;creator;</div>
<div class="line">            <span class="comment">// Retrieve parameter values</span></div>
<div class="line">            dpp::snowflake file_id = std::get&lt;dpp::snowflake&gt;(event.get_parameter(<span class="stringliteral">&quot;file&quot;</span>));</div>
<div class="line">            std::string emoji_name = std::get&lt;std::string&gt;(event.get_parameter(<span class="stringliteral">&quot;name&quot;</span>));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Get the attachment from the resolved list</span></div>
<div class="line">            const dpp::attachment &amp;attachment = event.command.get_resolved_attachment(file_id);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// For simplicity for this example we only support PNG</span></div>
<div class="line">            if (attachment.content_type != <span class="stringliteral">&quot;image/png&quot;</span>) {</div>
<div class="line">                <span class="comment">// While we could use event.co_reply, we can just use event.reply, as we will exit the command anyway and don&#39;t need to wait on the result</span></div>
<div class="line">                event.reply(<span class="stringliteral">&quot;Error: type &quot;</span> + attachment.content_type + <span class="stringliteral">&quot; not supported&quot;</span>);</div>
<div class="line">                co_return;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">// Send a &quot;&lt;bot&gt; is thinking...&quot; message, to wait on later so we can edit</span></div>
<div class="line">            <a class="code hl_class" href="classdpp_1_1async.html">dpp::async</a> thinking = event.<a class="code hl_function" href="structdpp_1_1interaction__create__t.html#ad4a64cd698d33194ab0c2df06401c0e5">co_thinking</a>(<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Download and co_await the result</span></div>
<div class="line">            <a class="code hl_struct" href="structdpp_1_1http__request__completion__t.html">dpp::http_request_completion_t</a> response = <span class="keyword">co_await</span> cluster-&gt;co_request(attachment.url, <a class="code hl_enumvalue" href="namespacedpp.html#a805ef1feb2862a208ec0e9d1be005c88a1c5397a2ab65a9b09e466d3e7cf5a82e">dpp::m_get</a>);</div>
<div class="line"> </div>
<div class="line">            if (response.status != 200) { <span class="comment">// Page didn&#39;t send the image</span></div>
<div class="line">                co_await thinking; <span class="comment">// Wait for the thinking response to arrive so we can edit</span></div>
<div class="line">                event.edit_response(<span class="stringliteral">&quot;Error: could not download the attachment&quot;</span>);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="comment">// Load the image data in a dpp::emoji</span></div>
<div class="line">                dpp::emoji emoji(emoji_name);</div>
<div class="line">                emoji.load_image(response.body, dpp::image_type::i_png);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Create the emoji and co_await the response</span></div>
<div class="line">                dpp::confirmation_callback_t confirmation = co_await cluster-&gt;co_guild_emoji_create(event.command.guild_id, emoji);</div>
<div class="line"> </div>
<div class="line">                co_await thinking; <span class="comment">// Wait for the thinking response to arrive so we can edit</span></div>
<div class="line">                if (confirmation.is_error()) {</div>
<div class="line">                    event.edit_response(<span class="stringliteral">&quot;Error: could not add emoji: &quot;</span> + confirmation.get_error().message);</div>
<div class="line">                } <span class="keywordflow">else</span> { <span class="comment">// Success</span></div>
<div class="line">                    event.edit_response(<span class="stringliteral">&quot;Successfully added &quot;</span> + confirmation.get&lt;dpp::emoji&gt;().get_mention()); <span class="comment">// Show the new emoji</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    bot.on_ready([&amp;bot](<span class="keyword">const</span> <a class="code hl_struct" href="structdpp_1_1ready__t.html">dpp::ready_t</a>&amp; event) {</div>
<div class="line">        <span class="keywordflow">if</span> (dpp::run_once&lt;struct register_bot_commands&gt;()) {</div>
<div class="line">            <a class="code hl_class" href="classdpp_1_1slashcommand.html">dpp::slashcommand</a> command(<span class="stringliteral">&quot;addemoji&quot;</span>, <span class="stringliteral">&quot;Add an emoji&quot;</span>, bot.me.id);</div>
<div class="line">            <span class="comment">// Add file and name as required parameters</span></div>
<div class="line">            command.add_option(<a class="code hl_struct" href="structdpp_1_1command__option.html">dpp::command_option</a>(<a class="code hl_enumvalue" href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58a51165f79fe5d1c99da7b663042d8622a">dpp::co_attachment</a>, <span class="stringliteral">&quot;file&quot;</span>, <span class="stringliteral">&quot;Select an image&quot;</span>, <span class="keyword">true</span>));</div>
<div class="line">            command.add_option(<a class="code hl_struct" href="structdpp_1_1command__option.html">dpp::command_option</a>(<a class="code hl_enumvalue" href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58acd751201efe224973dfe952d8658a384">dpp::co_string</a>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Name of the emoji to add&quot;</span>, <span class="keyword">true</span>));</div>
<div class="line"> </div>
<div class="line">            bot.global_command_create(command);</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    bot.start(<a class="code hl_enumvalue" href="namespacedpp.html#af447e04d0490cd4a9de085e4a758faa4a155f7db65696b4c09b5fcc41787e4726">dpp::st_wait</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassdpp_1_1async_html"><div class="ttname"><a href="classdpp_1_1async.html">dpp::async</a></div><div class="ttdoc">A co_await-able object handling an API call in parallel with the caller.</div><div class="ttdef"><b>Definition:</b> async.h:107</div></div>
<div class="ttc" id="aclassdpp_1_1cluster_html"><div class="ttname"><a href="classdpp_1_1cluster.html">dpp::cluster</a></div><div class="ttdoc">The cluster class represents a group of shards and a command queue for sending and receiving commands...</div><div class="ttdef"><b>Definition:</b> cluster.h:80</div></div>
<div class="ttc" id="aclassdpp_1_1cluster_html_ab840686c7cd2e15f4a66ab64f62e106b"><div class="ttname"><a href="classdpp_1_1cluster.html#ab840686c7cd2e15f4a66ab64f62e106b">dpp::cluster::on_log</a></div><div class="ttdeci">event_router_t&lt; log_t &gt; on_log</div><div class="ttdoc">Called when a log message is to be written to the log. You can attach any logging system here you wis...</div><div class="ttdef"><b>Definition:</b> cluster.h:560</div></div>
<div class="ttc" id="aclassdpp_1_1interaction_html_aabbb8d58d708128098516ed443d5c140"><div class="ttname"><a href="classdpp_1_1interaction.html#aabbb8d58d708128098516ed443d5c140">dpp::interaction::get_command_name</a></div><div class="ttdeci">std::string get_command_name() const</div><div class="ttdoc">Get the command name for a command interaction.</div></div>
<div class="ttc" id="aclassdpp_1_1slashcommand_html"><div class="ttname"><a href="classdpp_1_1slashcommand.html">dpp::slashcommand</a></div><div class="ttdoc">Represents an application command, created by your bot either globally, or on a guild.</div><div class="ttdef"><b>Definition:</b> appcommand.h:1342</div></div>
<div class="ttc" id="aclassdpp_1_1task_html"><div class="ttname"><a href="classdpp_1_1task.html">dpp::task</a></div><div class="ttdoc">A coroutine task. It starts immediately on construction and can be co_await-ed, making it perfect for...</div><div class="ttdef"><b>Definition:</b> task.h:95</div></div>
<div class="ttc" id="anamespacedpp_1_1utility_html_a8c2cc04bb80ffd287b376d5977899277"><div class="ttname"><a href="namespacedpp_1_1utility.html#a8c2cc04bb80ffd287b376d5977899277">dpp::utility::cout_logger</a></div><div class="ttdeci">std::function&lt; void(const dpp::log_t &amp;)&gt; DPP_EXPORT cout_logger()</div><div class="ttdoc">Get a default logger that outputs to std::cout. e.g.</div></div>
<div class="ttc" id="anamespacedpp_html_a805ef1feb2862a208ec0e9d1be005c88a1c5397a2ab65a9b09e466d3e7cf5a82e"><div class="ttname"><a href="namespacedpp.html#a805ef1feb2862a208ec0e9d1be005c88a1c5397a2ab65a9b09e466d3e7cf5a82e">dpp::m_get</a></div><div class="ttdeci">@ m_get</div><div class="ttdoc">GET.</div><div class="ttdef"><b>Definition:</b> queues.h:186</div></div>
<div class="ttc" id="anamespacedpp_html_abc401d86119c6443bf72d736857c1a58a51165f79fe5d1c99da7b663042d8622a"><div class="ttname"><a href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58a51165f79fe5d1c99da7b663042d8622a">dpp::co_attachment</a></div><div class="ttdeci">@ co_attachment</div><div class="ttdoc">File attachment type.</div><div class="ttdef"><b>Definition:</b> appcommand.h:104</div></div>
<div class="ttc" id="anamespacedpp_html_abc401d86119c6443bf72d736857c1a58acd751201efe224973dfe952d8658a384"><div class="ttname"><a href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58acd751201efe224973dfe952d8658a384">dpp::co_string</a></div><div class="ttdeci">@ co_string</div><div class="ttdoc">A string value.</div><div class="ttdef"><b>Definition:</b> appcommand.h:64</div></div>
<div class="ttc" id="anamespacedpp_html_af447e04d0490cd4a9de085e4a758faa4a155f7db65696b4c09b5fcc41787e4726"><div class="ttname"><a href="namespacedpp.html#af447e04d0490cd4a9de085e4a758faa4a155f7db65696b4c09b5fcc41787e4726">dpp::st_wait</a></div><div class="ttdeci">@ st_wait</div><div class="ttdoc">Wait forever on a condition variable. The cluster will spawn threads for each shard and start() will ...</div><div class="ttdef"><b>Definition:</b> cluster.h:63</div></div>
<div class="ttc" id="astructdpp_1_1command__option_html"><div class="ttname"><a href="structdpp_1_1command__option.html">dpp::command_option</a></div><div class="ttdoc">Each command option is a command line parameter. It can have a type (see dpp::command_option_type),...</div><div class="ttdef"><b>Definition:</b> appcommand.h:203</div></div>
<div class="ttc" id="astructdpp_1_1http__request__completion__t_html"><div class="ttname"><a href="structdpp_1_1http__request__completion__t.html">dpp::http_request_completion_t</a></div><div class="ttdoc">The result of any HTTP request. Contains the headers, vital rate limit figures, and returned request ...</div><div class="ttdef"><b>Definition:</b> queues.h:111</div></div>
<div class="ttc" id="astructdpp_1_1interaction__create__t_html_a8b0c69c156a1e532507a918c13414f14"><div class="ttname"><a href="structdpp_1_1interaction__create__t.html#a8b0c69c156a1e532507a918c13414f14">dpp::interaction_create_t::command</a></div><div class="ttdeci">interaction command</div><div class="ttdoc">command interaction</div><div class="ttdef"><b>Definition:</b> dispatcher.h:678</div></div>
<div class="ttc" id="astructdpp_1_1interaction__create__t_html_ad4a64cd698d33194ab0c2df06401c0e5"><div class="ttname"><a href="structdpp_1_1interaction__create__t.html#ad4a64cd698d33194ab0c2df06401c0e5">dpp::interaction_create_t::co_thinking</a></div><div class="ttdeci">dpp::async&lt; dpp::confirmation_callback_t &gt; co_thinking(bool ephemeral=false) const</div><div class="ttdoc">Set the bot to 'thinking' state where you have up to 15 minutes to respond.</div></div>
<div class="ttc" id="astructdpp_1_1ready__t_html"><div class="ttname"><a href="structdpp_1_1ready__t.html">dpp::ready_t</a></div><div class="ttdoc">Session ready.</div><div class="ttdef"><b>Definition:</b> dispatcher.h:961</div></div>
<div class="ttc" id="astructdpp_1_1slashcommand__t_html"><div class="ttname"><a href="structdpp_1_1slashcommand__t.html">dpp::slashcommand_t</a></div><div class="ttdoc">User has issued a slash command.</div><div class="ttdef"><b>Definition:</b> dispatcher.h:695</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md137"></a>
I heard you liked tasks</h3>
<dl class="section note"><dt>Note</dt><dd>This next example is fairly advanced and makes use of many of both C++ and D++'s advanced features.</dd></dl>
<p>Earlier we mentioned two other types of coroutines provided by dpp: <a class="el" href="classdpp_1_1coroutine.html" title="Base type for a coroutine, starts on co_await.">dpp::coroutine</a> and <a class="el" href="classdpp_1_1task.html" title="A coroutine task. It starts immediately on construction and can be co_await-ed, making it perfect for...">dpp::task</a>. They both take their return type as a template parameter, which may be void. Both <a class="el" href="structdpp_1_1job.html" title="Extremely light coroutine object designed to send off a coroutine to execute on its own....">dpp::job</a> and <a class="el" href="classdpp_1_1task.html" title="A coroutine task. It starts immediately on construction and can be co_await-ed, making it perfect for...">dpp::task</a> start on the constructor for asynchronous execution, however only the latter can be <code>co_await</code>-ed, this allows you to retrieve its return value. If a <a class="el" href="classdpp_1_1task.html" title="A coroutine task. It starts immediately on construction and can be co_await-ed, making it perfect for...">dpp::task</a> is destroyed before it ends, it is cancelled and will stop when it is resumed from the next <code>co_await</code>. <a class="el" href="classdpp_1_1coroutine.html" title="Base type for a coroutine, starts on co_await.">dpp::coroutine</a> also has a return value and can be <code>co_await</code>-ed, however it only starts when <code>co_await</code>-ing, meaning it is executed synchronously.</p>
<p >Here is an example of a command making use of <a class="el" href="classdpp_1_1task.html" title="A coroutine task. It starts immediately on construction and can be co_await-ed, making it perfect for...">dpp::task</a> to retrieve the avatar of a specified user, or if missing, the sender:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;dpp/dpp.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <a class="code hl_class" href="classdpp_1_1cluster.html">dpp::cluster</a> bot{<span class="stringliteral">&quot;token&quot;</span>};</div>
<div class="line"> </div>
<div class="line">    bot.<a class="code hl_variable" href="classdpp_1_1cluster.html#ab840686c7cd2e15f4a66ab64f62e106b">on_log</a>(<a class="code hl_function" href="namespacedpp_1_1utility.html#a8c2cc04bb80ffd287b376d5977899277">dpp::utility::cout_logger</a>());</div>
<div class="line"> </div>
<div class="line">    bot.on_slashcommand([](<span class="keyword">const</span> <a class="code hl_struct" href="structdpp_1_1slashcommand__t.html">dpp::slashcommand_t</a>&amp; event) -&gt; <a class="code hl_class" href="classdpp_1_1task.html">dpp::task&lt;void&gt;</a> {</div>
<div class="line">        <span class="keywordflow">if</span> (event.<a class="code hl_variable" href="structdpp_1_1interaction__create__t.html#a8b0c69c156a1e532507a918c13414f14">command</a>.<a class="code hl_function" href="classdpp_1_1interaction.html#aabbb8d58d708128098516ed443d5c140">get_command_name</a>() == <span class="stringliteral">&quot;avatar&quot;</span>) {</div>
<div class="line">            <span class="comment">// Make a nested coroutine to fetch the guild member requested, that returns it as an optional</span></div>
<div class="line">            constexpr auto resolve_member = [](const dpp::slashcommand_t &amp;event) -&gt; dpp::task&lt;std::optional&lt;dpp::guild_member&gt;&gt; {</div>
<div class="line">                const dpp::command_value &amp;user_param = event.get_parameter(<span class="stringliteral">&quot;user&quot;</span>);</div>
<div class="line">                dpp::snowflake user_id;</div>
<div class="line">                if (std::holds_alternative&lt;std::monostate&gt;(user_param)) {</div>
<div class="line">                    user_id = event.command.usr.id; <span class="comment">// Parameter is empty so user is sender</span></div>
<div class="line">                }</div>
<div class="line">                else if (std::holds_alternative&lt;dpp::snowflake&gt;(user_param)) {</div>
<div class="line">                    user_id = std::get&lt;dpp::snowflake&gt;(user_param); <span class="comment">// Parameter has a user</span></div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// If we have the guild member in the command&#39;s resolved data, return it</span></div>
<div class="line">                const auto &amp;member_map = event.command.resolved.members;</div>
<div class="line">                if (auto member = member_map.find(user_id); member != member_map.end()) {</div>
<div class="line">                    co_return member-&gt;second;</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// Try looking in guild cache</span></div>
<div class="line">                dpp::guild *guild = dpp::find_guild(event.command.guild_id);</div>
<div class="line">                if (guild) {</div>
<div class="line">                    <span class="comment">// Look in guild&#39;s member cache</span></div>
<div class="line">                    if (auto member = guild-&gt;members.find(user_id); member != guild-&gt;members.end()) {</div>
<div class="line">                        co_return member-&gt;second;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// Finally if everything else failed, request API</span></div>
<div class="line">                dpp::confirmation_callback_t confirmation = co_await event.from-&gt;creator-&gt;co_guild_get_member(event.command.guild_id, user_id);</div>
<div class="line">                if (confirmation.is_error()) {</div>
<div class="line">                    co_return std::nullopt; <span class="comment">// Member not found, return empty</span></div>
<div class="line">                } else {</div>
<div class="line">                    co_return confirmation.get&lt;dpp::guild_member&gt;();</div>
<div class="line">                }</div>
<div class="line">            };</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Send a &quot;&lt;bot&gt; is thinking...&quot; message, to wait on later so we can edit</span></div>
<div class="line">            <a class="code hl_class" href="classdpp_1_1async.html">dpp::async</a> thinking = event.<a class="code hl_function" href="structdpp_1_1interaction__create__t.html#ad4a64cd698d33194ab0c2df06401c0e5">co_thinking</a>(<span class="keyword">false</span>);</div>
<div class="line">            <span class="comment">// Call our coroutine defined above to retrieve the member requested</span></div>
<div class="line">            std::optional&lt;dpp::guild_member&gt; member = <span class="keyword">co_await</span> resolve_member(event);</div>
<div class="line">            <span class="keywordflow">if</span> (!member.has_value()) {</div>
<div class="line">                <span class="comment">// Wait for the thinking response to arrive to make sure we can edit</span></div>
<div class="line">                co_await thinking;</div>
<div class="line">                event.edit_original_response(dpp::message{<span class="stringliteral">&quot;User not found in this server!&quot;</span>});</div>
<div class="line">                <span class="keyword">co_return</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            std::string avatar_url = member-&gt;get_avatar_url(512);</div>
<div class="line">            <span class="keywordflow">if</span> (avatar_url.empty()) { <span class="comment">// Member does not have a custom avatar for this server, get their user avatar</span></div>
<div class="line">                <a class="code hl_struct" href="structdpp_1_1confirmation__callback__t.html">dpp::confirmation_callback_t</a> confirmation = <span class="keyword">co_await</span> <span class="keyword">event</span>.from-&gt;creator-&gt;co_user_get_cached(member-&gt;user_id);</div>
<div class="line">                <span class="keywordflow">if</span> (confirmation.<a class="code hl_function" href="structdpp_1_1confirmation__callback__t.html#a17820d5f9fb0725d64a1bf23c8cc97c7">is_error</a>()) {</div>
<div class="line">                    <span class="comment">// Wait for the thinking response to arrive to make sure we can edit</span></div>
<div class="line">                    <span class="keyword">co_await</span> <a class="code hl_variable" href="namespacedpp_1_1unicode__emoji.html#ac5cfa36ec5ab5ccde71de640d7f4b065">thinking</a>;</div>
<div class="line">                    <span class="keyword">event</span>.edit_original_response(<a class="code hl_struct" href="structdpp_1_1message.html">dpp::message</a>{<span class="stringliteral">&quot;User not found!&quot;</span>});</div>
<div class="line">                    <span class="keyword">co_return</span>;</div>
<div class="line">                }</div>
<div class="line">                avatar_url = confirmation.<a class="code hl_function" href="structdpp_1_1confirmation__callback__t.html#ac32b677abe27aa496063ee34a4ae1fbd">get</a>&lt;<a class="code hl_class" href="classdpp_1_1user__identified.html">dpp::user_identified</a>&gt;().get_avatar_url(512);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Wait for the thinking response to arrive to make sure we can edit</span></div>
<div class="line">            <span class="keyword">co_await</span> <a class="code hl_variable" href="namespacedpp_1_1unicode__emoji.html#ac5cfa36ec5ab5ccde71de640d7f4b065">thinking</a>;</div>
<div class="line">            <span class="keyword">event</span>.edit_original_response(<a class="code hl_struct" href="structdpp_1_1message.html">dpp::message</a>{avatar_url});</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    bot.on_ready([&amp;bot](<span class="keyword">const</span> <a class="code hl_struct" href="structdpp_1_1ready__t.html">dpp::ready_t</a>&amp; event) {</div>
<div class="line">        <span class="keywordflow">if</span> (dpp::run_once&lt;struct register_bot_commands&gt;()) {</div>
<div class="line">            <a class="code hl_class" href="classdpp_1_1slashcommand.html">dpp::slashcommand</a> command(<span class="stringliteral">&quot;avatar&quot;</span>, <span class="stringliteral">&quot;Get your or another user&#39;s avatar image&quot;</span>, bot.me.id);</div>
<div class="line">            command.add_option(<a class="code hl_struct" href="structdpp_1_1command__option.html">dpp::command_option</a>(<a class="code hl_enumvalue" href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58a5a2ea837ca5ec64e6385acf392cef1e2">dpp::co_user</a>, <span class="stringliteral">&quot;user&quot;</span>, <span class="stringliteral">&quot;User to fetch the avatar from&quot;</span>));</div>
<div class="line"> </div>
<div class="line">            bot.global_command_create(command);</div>
<div class="line">        }</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    bot.start(<a class="code hl_enumvalue" href="namespacedpp.html#af447e04d0490cd4a9de085e4a758faa4a155f7db65696b4c09b5fcc41787e4726">dpp::st_wait</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclassdpp_1_1user__identified_html"><div class="ttname"><a href="classdpp_1_1user__identified.html">dpp::user_identified</a></div><div class="ttdoc">A user with additional fields only available via the oauth2 identify scope. These are not included in...</div><div class="ttdef"><b>Definition:</b> user.h:465</div></div>
<div class="ttc" id="anamespacedpp_1_1unicode__emoji_html_ac5cfa36ec5ab5ccde71de640d7f4b065"><div class="ttname"><a href="namespacedpp_1_1unicode__emoji.html#ac5cfa36ec5ab5ccde71de640d7f4b065">dpp::unicode_emoji::thinking</a></div><div class="ttdeci">constexpr const char thinking[]</div><div class="ttdef"><b>Definition:</b> unicode_emoji.h:1691</div></div>
<div class="ttc" id="anamespacedpp_html_abc401d86119c6443bf72d736857c1a58a5a2ea837ca5ec64e6385acf392cef1e2"><div class="ttname"><a href="namespacedpp.html#abc401d86119c6443bf72d736857c1a58a5a2ea837ca5ec64e6385acf392cef1e2">dpp::co_user</a></div><div class="ttdeci">@ co_user</div><div class="ttdoc">A user snowflake id.</div><div class="ttdef"><b>Definition:</b> appcommand.h:79</div></div>
<div class="ttc" id="astructdpp_1_1confirmation__callback__t_html"><div class="ttname"><a href="structdpp_1_1confirmation__callback__t.html">dpp::confirmation_callback_t</a></div><div class="ttdoc">The results of a REST call wrapped in a convenient struct.</div><div class="ttdef"><b>Definition:</b> restresults.h:255</div></div>
<div class="ttc" id="astructdpp_1_1confirmation__callback__t_html_a17820d5f9fb0725d64a1bf23c8cc97c7"><div class="ttname"><a href="structdpp_1_1confirmation__callback__t.html#a17820d5f9fb0725d64a1bf23c8cc97c7">dpp::confirmation_callback_t::is_error</a></div><div class="ttdeci">bool is_error() const</div><div class="ttdoc">Returns true if the call resulted in an error rather than a legitimate value in the confirmation_call...</div></div>
<div class="ttc" id="astructdpp_1_1confirmation__callback__t_html_ac32b677abe27aa496063ee34a4ae1fbd"><div class="ttname"><a href="structdpp_1_1confirmation__callback__t.html#ac32b677abe27aa496063ee34a4ae1fbd">dpp::confirmation_callback_t::get</a></div><div class="ttdeci">T get() const</div><div class="ttdoc">Get the stored value via std::get.</div><div class="ttdef"><b>Definition:</b> restresults.h:323</div></div>
<div class="ttc" id="astructdpp_1_1message_html"><div class="ttname"><a href="structdpp_1_1message.html">dpp::message</a></div><div class="ttdoc">Represents messages sent and received on Discord.</div><div class="ttdef"><b>Definition:</b> message.h:2034</div></div>
</div><!-- fragment --> </div></div><!-- contents --><script src="https://giscus.app/client.js" data-repo="brainboxdotcc/dpp-comments" data-repo-id="R_kgDOHOY4xg" data-category="General" data-category-id="DIC_kwDOHOY4xs4CRYtj" data-mapping="pathname" data-strict="1" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" data-loading="lazy" crossorigin="anonymous" async></script>
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath">
	<ul>
		<li class="navelem"><a class="el" href="example-programs.html">Example Programs</a></li><li class="navelem"><a class="el" href="using-coroutines.html">Using Coroutines</a></li>
	</ul>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QTH6YHBNG5"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100&display=swap" rel="stylesheet">
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-QTH6YHBNG5');
	$(function() {
		$(".fragment").each(function(i,node) {
			var $node = $(node);
			$node.children(":not(.line)").remove();
			$node.html("<pre><code class='stan'>" + $node.text().trim().replaceAll("<", "&lt;").replaceAll(">", "&gt;") + "</code></pre>");
			hljs.configure({
				languages: ['cpp','diff','cmake','bash','sh','text'],
				ignoreUnescapedHTML: true
			});
			hljs.highlightAll(node);
			hljs.initLineNumbersOnLoad(node);  
		});
		$(".fragment").parent().parent().parent().parent().removeClass('doxtable');
	});
</script>
<style>
	.hljs-ln-code, code, code a, pre.fragment, div.fragment, div.fragment .line, div.fragment span, div.fragment .line a, div.fragment .line span {
		font-family: 'JetBrains Mono', monospace !important;
		font-size: 0.8rem !important;
	}
	.fragment {
		padding: 0 !important;
		margin-top: 0 !important;
		margin-bottom: 0 !important;
		background: none !important;
		border: 0 !important;
	}
	.hljs-ln-n::before {
		content: attr(data-line-number);
		padding-right: 1rem !important;
	}
	table.markdownTable code td, table.markdownTable code th, table.fieldtable code td, table.fieldtable code th, table.doxtable code td, table.doxtable code th {
		border: 0 !important;
		padding: 0 !important;
	}	
</style>
<div style="z-index: -9999; position: absolute; right: 0; top: 0; font-size: 0.0001rem;color:transparent;background:none">
	<!-- For crawlability of past versions -->
	<a href='/10.0.35/'>D++ Library version 10.0.35</a><a href='/10.0.34/'>D++ Library version 10.0.34</a><a href='/10.0.33/'>D++ Library version 10.0.33</a><a href='/10.0.32/'>D++ Library version 10.0.32</a><a href='/10.0.31/'>D++ Library version 10.0.31</a><a href='/10.0.30/'>D++ Library version 10.0.30</a><a href='/10.0.29/'>D++ Library version 10.0.29</a><a href='/10.0.28/'>D++ Library version 10.0.28</a><a href='/10.0.27/'>D++ Library version 10.0.27</a><a href='/10.0.26/'>D++ Library version 10.0.26</a><a href='/10.0.25/'>D++ Library version 10.0.25</a><a href='/10.0.24/'>D++ Library version 10.0.24</a><a href='/10.0.23/'>D++ Library version 10.0.23</a><a href='/10.0.22/'>D++ Library version 10.0.22</a><a href='/10.0.21/'>D++ Library version 10.0.21</a><a href='/10.0.20/'>D++ Library version 10.0.20</a><a href='/10.0.19/'>D++ Library version 10.0.19</a><a href='/10.0.18/'>D++ Library version 10.0.18</a><a href='/10.0.17/'>D++ Library version 10.0.17</a><a href='/10.0.16/'>D++ Library version 10.0.16</a><a href='/10.0.15/'>D++ Library version 10.0.15</a><a href='/10.0.14/'>D++ Library version 10.0.14</a><a href='/10.0.13/'>D++ Library version 10.0.13</a><a href='/10.0.12/'>D++ Library version 10.0.12</a><a href='/10.0.11/'>D++ Library version 10.0.11</a><a href='/10.0.10/'>D++ Library version 10.0.10</a><a href='/10.0.9/'>D++ Library version 10.0.9</a><a href='/10.0.8/'>D++ Library version 10.0.8</a><a href='/10.0.7/'>D++ Library version 10.0.7</a><a href='/10.0.6/'>D++ Library version 10.0.6</a><a href='/10.0.5/'>D++ Library version 10.0.5</a><a href='/10.0.4/'>D++ Library version 10.0.4</a><a href='/10.0.3/'>D++ Library version 10.0.3</a><a href='/10.0.2/'>D++ Library version 10.0.2</a><a href='/10.0.1/'>D++ Library version 10.0.1</a><a href='/10.0.0/'>D++ Library version 10.0.0</a><a href='/9.0.19/'>D++ Library version 9.0.19</a><a href='/9.0.18/'>D++ Library version 9.0.18</a><a href='/9.0.17/'>D++ Library version 9.0.17</a><a href='/9.0.16/'>D++ Library version 9.0.16</a><a href='/9.0.15/'>D++ Library version 9.0.15</a><a href='/9.0.14/'>D++ Library version 9.0.14</a><a href='/9.0.13/'>D++ Library version 9.0.13</a><a href='/9.0.12/'>D++ Library version 9.0.12</a><a href='/9.0.11/'>D++ Library version 9.0.11</a><a href='/9.0.10/'>D++ Library version 9.0.10</a><a href='/9.0.9/'>D++ Library version 9.0.9</a><a href='/9.0.8/'>D++ Library version 9.0.8</a><a href='/9.0.7/'>D++ Library version 9.0.7</a><a href='/9.0.6/'>D++ Library version 9.0.6</a><a href='/9.0.5/'>D++ Library version 9.0.5</a><a href='/9.0.4/'>D++ Library version 9.0.4</a><a href='/9.0.3/'>D++ Library version 9.0.3</a><a href='/9.0.2/'>D++ Library version 9.0.2</a><a href='/9.0.1/'>D++ Library version 9.0.1</a><a href='/9.0.0/'>D++ Library version 9.0.0</a><a href='/1.0.2/'>D++ Library version 1.0.2</a><a href='/1.0.1/'>D++ Library version 1.0.1</a><a href='/1.0.0/'>D++ Library version 1.0.0</a>
</div>
</body>
</html>
